(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/goods_details/discountsGoodsList"],{"05ce":function(t,e,s){"use strict";s.d(e,"b",(function(){return i})),s.d(e,"c",(function(){return c})),s.d(e,"a",(function(){}));var i=function(){var t=this,e=t.$createElement,s=(t._self._c,t.__map(t.discountsData,(function(e,s){var i=t.__get_orig(e),c=t.proNum==s?t.__map(e.products,(function(s,i){var c=t.__get_orig(s),r=1==e.type?t.selectValue.includes(s.id+"")||1==e.type&&0==i:null;return{$orig:c,g0:r}})):null;return{$orig:i,l0:c}})));t.$mp.data=Object.assign({},{$root:{l1:s}})},c=[]},"5a9b":function(t,e,s){"use strict";(function(t,e){var i=s("4ea4");s("8824");i(s("66fd"));var c=i(s("5f95"));t.__webpack_require_UNI_MP_PLUGIN__=s,e(c.default)}).call(this,s("bc2e")["default"],s("543d")["createPage"])},"5d4c":function(t,e,s){"use strict";var i=s("9bea"),c=s.n(i);c.a},"5f95":function(t,e,s){"use strict";s.r(e);var i=s("05ce"),c=s("6c09");for(var r in c)["default"].indexOf(r)<0&&function(t){s.d(e,t,(function(){return c[t]}))}(r);s("5d4c");var a=s("f0c5"),u=Object(a["a"])(c["default"],i["b"],i["c"],!1,null,"8caf80ee",null,!1,i["a"],void 0);e["default"]=u.exports},"6b46":function(t,e,s){"use strict";(function(t){var i=s("4ea4");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var c=s("78a2"),r=i(s("a29e")),a={components:{productWindow:function(){s.e("components/productWindow/index").then(function(){return resolve(s("82c0"))}.bind(null,s)).catch(s.oe)}},mixins:[r.default],data:function(){return{productId:"",discountsData:[],attr:{cartAttr:!1,productAttr:[],productSelect:{}},productValue:[],isOpen:!1,attrValue:[],attrTxt:"",cartList:{valid:[],invalid:[]},selectAttr:[],selectValue:[],proNum:0,images:[],selectCountPrice:[],selectTitle:"",saveMoney:0}},onLoad:function(t){this.productId=t.id,this.getData(0)},onShow:function(){t.removeStorageSync("form_type_cart")},methods:{getData:function(e){var s=this;(0,c.storeDiscountsList)(this.productId).then((function(i){if(s.discountsData=i.data,!s.discountsData.length)return t.navigateBack({delta:1});if(i.data[e].products.map((function(t,c){s.seleNum=c,s.attr.productAttr=i.data[e].products[c].productAttr,s.productValue=i.data[e].products[c].productValue,s.$set(s.selectAttr,[c],i.data[e].products[c].productValue),s.selectValue.push(i.data[e].products[c].id+""),s.DefaultSelect()})),!s.images.length)for(var c=0;c<i.data.length;c++){s.selectCountPrice.push({min:i.data[c].min_price,total_pic:0}),s.images.push([]);for(var r=0;r<i.data[c].products.length;r++)s.images[c].push(i.data[c].products[r].image)}s.switchSelect()})).catch((function(e){t.showToast({title:e,icon:"none",duration:2e3}),setTimeout((function(e){t.navigateTo({url:"/pages/goods_details/index?id="+s.productId})}),1001)}))},getList:function(t){var e=this;if(this.selectValue=[],this.discountsData[t].products.map((function(s,i){e.seleNum=i,e.attr.productAttr=e.discountsData[t].products[i].productAttr,e.productValue=e.discountsData[t].products[i].productValue,e.$set(e.selectAttr,[i],e.discountsData[t].products[i].productValue),e.$set(e.selectValue,[i],e.discountsData[t].products[i].id+""),e.DefaultSelect()})),!this.images.length)for(var s=0;s<this.discountsData.length;s++){this.selectCountPrice.push({min:this.discountsData[s].min_price,total_pic:0}),this.images.push([]);for(var i=0;i<this.discountsData[s].products.length;i++)this.images[s].push(this.discountsData[s].products[i].image)}this.switchSelect(),this.proNum=t},attrVal:function(t){this.$set(this.attr.productAttr[t.indexw],"index",this.attr.productAttr[t.indexw].attr_values[t.indexn])},ChangeAttr:function(t){var e=this.productValue[t];e&&e.stock>0?(this.$set(this.attr.productSelect,"image",e.image),this.$set(this.attr.productSelect,"price",e.price),this.$set(this.attr.productSelect,"stock",e.stock),this.$set(this.attr.productSelect,"product_stock",e.product_stock),this.$set(this.attr.productSelect,"unique",e.unique),this.$set(this.attr.productSelect,"cart_num",1),this.$set(this.attr.productSelect,"vip_price",e.vip_price),this.$set(this,"attrTxt","已选择"),this.attrValue[this.seleNum]=t||""):(this.$set(this.attr.productSelect,"image",e.image),this.$set(this.attr.productSelect,"price",e.price),this.$set(this.attr.productSelect,"product_stock",e.product_stock),this.$set(this.attr.productSelect,"stock",0),this.$set(this.attr.productSelect,"unique",""),this.$set(this.attr.productSelect,"cart_num",0),this.$set(this.attr.productSelect,"vip_price",e.vip_price),this.attrValue[this.seleNum]=t||"",this.$set(this,"attrTxt","请选择")),this.$set(this.selectAttr,[this.seleNum],e),this.switchSelect()},DefaultSelect:function(){var t=this.attr.productAttr,e=[],s=[];for(var i in this.productValue)s.push(this.productValue[i].price);var c=Math.min.apply(null,s);for(var i in this.productValue)if(this.productValue[i].product_stock>0&&this.productValue[i].price==c){e=this.attr.productAttr.length?i.split(","):[];break}for(var r=0;r<t.length;r++)this.$set(t[r],"index",e[r]);var a=this.productValue[e.join(",")];a&&t.length?(this.$set(this.attr.productSelect,"store_name",a.title),this.$set(this.attr.productSelect,"image",a.image),this.$set(this.attr.productSelect,"price",a.price),this.$set(this.attr.productSelect,"stock",a.stock),this.$set(this.attr.productSelect,"product_stock",a.product_stock),this.$set(this.attr.productSelect,"unique",a.unique),this.$set(this.attr.productSelect,"cart_num",1),this.$set(this.attr.productSelect,"vip_price",a.vip_price),this.attrValue[this.seleNum]=e.join(",")):!a&&t.length?(this.$set(this.attr.productSelect,"store_name",a.store_name),this.$set(this.attr.productSelect,"image",a.image),this.$set(this.attr.productSelect,"price",a.price),this.$set(this.attr.productSelect,"product_stock",a.product_stock),this.$set(this.attr.productSelect,"stock",0),this.$set(this.attr.productSelect,"unique",""),this.$set(this.attr.productSelect,"cart_num",0),this.$set(this.attr.productSelect,"vip_price",a.vip_price),this.attrValue[this.seleNum]=""):a||t.length||(this.$set(this.attr.productSelect,"store_name",a.store_name),this.$set(this.attr.productSelect,"image",a.image),this.$set(this.attr.productSelect,"price",a.price),this.$set(this.attr.productSelect,"stock",a.stock),this.$set(this.attr.productSelect,"product_stock",a.product_stock),this.$set(this.attr.productSelect,"unique",a.unique||""),this.$set(this.attr.productSelect,"cart_num",1),this.$set(this.attr.productSelect,"vip_price",a.vip_price),this.$set(this,"attrValue",""),this.attrValue[this.seleNum]="",this.$set(this,"attrTxt","请选择")),this.$set(this.selectAttr,[this.seleNum],a)},selecAttr:function(t,e){var s=this;this.proNum=t,this.seleNum=e,this.selectTitle=this.discountsData[t].products[e].title,this.attr.productAttr=this.discountsData[t].products[e].productAttr,this.productValue=this.discountsData[t].products[e].productValue,this.DefaultSelect(),this.$nextTick((function(t){s.$set(s.attr,"cartAttr",!0),s.$set(s,"isOpen",!0)}))},onMyEvent:function(){this.$set(this.attr,"cartAttr",!1),this.$set(this,"isOpen",!1),this.switchSelect()},setAllSelectValue:function(t){var e=this,s=[],i=e.cartList.valid;if(i.length>0){var c=i.map((function(i){return t?(e.footerswitch?i.attrStatus?(i.checked=!0,s.push(i.id)):i.checked=!1:(i.checked=!0,s.push(i.id)),e.isAllSelect=!0):(i.checked=!1,e.isAllSelect=!1),i}));e.$set(e.cartList,"valid",c),e.selectValue=s,e.switchSelect()}},checkboxChange:function(t){var e=this,s=t.detail.value,i=e.cartList.valid,c=[],r=[],a=[],u=i.map((function(t){return e.inArray(t.id,s)?e.footerswitch?t.attrStatus?(t.checked=!0,c.push(t)):t.checked=!1:(t.checked=!0,c.push(t)):(t.checked=!1,r.push(t)),t}));e.footerswitch&&(a=r.filter((function(t){return!t.attrStatus}))),e.$set(e.cartList,"valid",u),e.isAllSelect=u.length===c.length+a.length,e.selectValue=s,e.switchSelect()},switchSelect:function(){var t=0,e=0;for(var s in this.selectAttr)this.selectValue.includes(this.selectAttr[s].product_id+"")&&(t+=Number(this.selectAttr[s].price),e+=Number(this.selectAttr[s].product_price));this.selectCountPrice[this.proNum].total_pic=t,this.saveMoney=Number(e-t).toFixed(2)||0},changeShow:function(t){this.selectValue=[],t===this.proNum?(this.proNum=-1,this.selectCountPrice[t].total_pic=0):(this.proNum=t,this.getList(t))},subData:function(e){var s=this,i=[],r={new:1,discountId:this.discountsData[e].id,discountInfos:[]};if(0==this.discountsData[e].type)this.selectValue=[],this.discountsData[e].products.map((function(t){s.selectValue.push(t.id+"")}));else if(this.selectValue.length<2)return this.selectValue=[],this.$util.Tips({title:"请先选择套餐商品"});for(var a=0;a<this.discountsData[e].products.length;a++)for(var u=0;u<this.selectValue.length;u++)this.discountsData[e].products[a].id==this.selectValue[u]&&(i.push(this.selectAttr[a]),r.discountInfos.push({id:this.discountsData[e].products[a].id,unique:this.selectAttr[a].unique,product_id:this.discountsData[e].products[a].product_id}));(0,c.postCartAdd)(r).then((function(e){t.navigateTo({url:"/pages/goods/order_confirm/index?new=1&noCoupon=1&cartId="+e.data.cartId.join(",")})})).catch((function(t){return s.selectValue=[],s.$util.Tips({title:t})}))},goOrder:function(){this.$set(this,"isOpen",!1),this.$set(this.attr,"cartAttr",!1)}}};e.default=a}).call(this,s("543d")["default"])},"6c09":function(t,e,s){"use strict";s.r(e);var i=s("6b46"),c=s.n(i);for(var r in i)["default"].indexOf(r)<0&&function(t){s.d(e,t,(function(){return i[t]}))}(r);e["default"]=c.a},"9bea":function(t,e,s){}},[["5a9b","common/runtime","common/vendor"]]]);
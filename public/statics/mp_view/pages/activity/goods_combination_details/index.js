(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/activity/goods_combination_details/index"],{"43f6":function(t,e,i){},5719:function(t,e,i){"use strict";var o=i("43f6"),s=i.n(o);s.a},"7bda":function(t,e,i){"use strict";(function(t){var o=i("4ea4");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=i("26cb"),n=(i("d5f7"),i("3995")),r=i("78a2"),a=i("ace8"),u=(i("99c8"),i("5f9b")),c=o(i("a29e")),l=i("9357"),h=getApp(),d=t.getSystemInfoSync().statusBarHeight,p={components:{zbCode:function(){Promise.all([i.e("common/vendor"),i.e("components/zb-code/zb-code")]).then(function(){return resolve(i("0657"))}.bind(null,i)).catch(i.oe)},productConSwiper:function(){i.e("components/productConSwiper/index").then(function(){return resolve(i("4550"))}.bind(null,i)).catch(i.oe)},kefuIcon:function(){i.e("components/kefuIcon/index").then(function(){return resolve(i("2004"))}.bind(null,i)).catch(i.oe)},"jyf-parser":function(){Promise.all([i.e("common/vendor"),i.e("components/jyf-parser/jyf-parser")]).then(function(){return resolve(i("217b"))}.bind(null,i)).catch(i.oe)},"product-window":function(){i.e("components/productWindow/index").then(function(){return resolve(i("82c0"))}.bind(null,i)).catch(i.oe)},userEvaluation:function(){i.e("components/userEvaluation/index").then(function(){return resolve(i("56cf"))}.bind(null,i)).catch(i.oe)},countDown:function(){i.e("components/countDown/index").then(function(){return resolve(i("00a7"))}.bind(null,i)).catch(i.oe)},cusPreviewImg:function(){i.e("components/cusPreviewImg/index").then(function(){return resolve(i("17d4"))}.bind(null,i)).catch(i.oe)},homeList:function(){i.e("components/homeList/index").then(function(){return resolve(i("8164"))}.bind(null,i)).catch(i.oe)}},computed:(0,s.mapGetters)({isLogin:"isLogin",userData:"userInfo"}),mixins:[c.default],data:function(){return{showSkeleton:!0,isNodes:0,dataShow:0,navH:"",id:0,userInfo:{},itemNew:[],indicatorDots:!1,circular:!0,autoplay:!0,interval:3e3,duration:500,attribute:{cartAttr:!1,productAttr:[],productSelect:{}},productValue:[],isOpen:!1,attr:"请选择",attrValue:"",AllIndex:2,maxAllIndex:0,replyChance:"",limitNum:1,timeer:null,iSplus:!1,navList:["商品","评价","详情"],opacity:0,scrollY:0,topArr:[],toView:"",height:0,heightArr:[],lock:!1,scrollTop:0,storeInfo:{brand_name:""},pink_ok_sum:0,pink:[],replyCount:0,reply:[],imgUrls:[],sharePacket:"",tagStyle:{img:"width:100%;display:block;",table:"width:100%",video:"width:100%"},posters:!1,weixinStatus:!1,posterImageStatus:!1,canvasStatus:!1,storeImage:"",PromotionCode:"",posterImage:"",posterbackgd:"/static/images/posterbackgd.png",navActive:0,actionSheetHidden:!1,attrTxt:"",cart_num:"",isAuto:!1,isShowAuth:!1,AllIndexDefault:0,homeTop:20,returnShow:!0,H5ShareBox:!1,routineContact:0,siteName:"",themeColor:"",fontColor:"",skuArr:[],codeShow:!1,cid:"1",codeVal:"",size:200,unit:"upx",background:"#FFF",foreground:"#000",pdground:"#000",codeIcon:"",iconsize:40,lv:3,onval:!0,loadMake:!0,base64Show:0,shareQrcode:0,followCode:"",selectSku:{},currentPage:!1,sysHeight:d,imgHost:u.HTTP_REQUEST_URL,posterTitle:"",headerRight:0,headerLeft:0}},watch:{isLogin:{handler:function(t,e){},deep:!0}},onLoad:function(e){var i=this,o=this,s=getCurrentPages();if(o.returnShow=1!==s.length,this.$nextTick((function(){var e=t.getMenuButtonBoundingClientRect(),o=t.createSelectorQuery().in(i);o.select("#home").boundingClientRect((function(t){i.homeTop=2*e.top+e.height-t.height})).exec()})),this.navH=h.globalData.navHeight,t.getSystemInfo({success:function(t){o.height=t.windowHeight}}),e.scene){var n=this.$util.getUrlParams(decodeURIComponent(e.scene));n.id&&(e.id=n.id),n.spid&&(h.globalData.spid=n.spid)}if(!e.id&&!e.scene)return this.$util.Tips({title:"缺少参数无法查看商品"},{tab:3,url:1});if(e.hasOwnProperty("id"))this.id=e.id,e.spid&&(h.globalData.spid=e.spid),this.combinationDetail(),this.isLogin&&e.id?o.downloadFilePromotionCode():this.$Cache.set("login_back_url","/pages/activity/goods_combination_details/index?id=".concat(e.id));else try{var r=t.getStorageSync("comGoodsId");""!=r&&(this.id=r,this.combinationDetail())}catch(u){t.showToast({title:"参数错误",icon:"none",duration:1e3,mask:!0})}this.colorData();var a=[{themeColor:"#1DB0FC",fontColor:"#FD502F"},{themeColor:"#42CA4D",fontColor:"#FF7600"},{themeColor:"#e93323",fontColor:"#e93323"},{themeColor:"#FF448F",fontColor:"#FF448F"},{themeColor:"#FE5C2D",fontColor:"#FE5C2D"},{themeColor:"#E0A558",fontColor:"#DA8C18"}];setTimeout((function(){switch(i.colorNum){case 1:i.themeColor=a[0].themeColor,i.fontColor=a[0].fontColor;break;case 2:i.themeColor=a[1].themeColor,i.fontColor=a[1].fontColor;break;case 3:i.themeColor=a[2].themeColor,i.fontColor=a[2].fontColor;break;case 4:i.themeColor=a[3].themeColor,i.fontColor=a[3].fontColor;break;case 5:i.themeColor=a[4].themeColor,i.fontColor=a[4].fontColor;break;case 6:i.themeColor=a[5].themeColor,i.fontColor=a[5].fontColor;break;default:i.themeColor=a[2].themeColor,i.fontColor=a[2].fontColor;break}}),1)},onReady:function(){var e=this;this.isNodes++,h.globalData.openPages="/pages/activity/goods_combination_details/index?id="+this.id+"&spid="+this.$store.state.app.uid;var i=t.getSystemInfoSync(),o=t.getMenuButtonBoundingClientRect(),s=t.createSelectorQuery().in(this);s.select("#home").boundingClientRect((function(t){e.headerRight=i.windowWidth-o.right+o.width,e.headerLeft=t.left+t.width})).exec()},onShow:function(){t.removeStorageSync("form_type_cart")},methods:{changeLogin:function(){this.getIsLogin()},getIsLogin:function(){this.isShowAuth=!0},spellBnt:function(e){this.isLogin?t.navigateTo({url:"/pages/activity/goods_combination_status/index?id="+e.id}):this.getIsLogin()},moreNav:function(){this.currentPage=!this.currentPage},showImg:function(t){this.$refs.cusPreviewImg.open(this.selectSku.suk)},changeSwitch:function(t){var e=this,i=this.skuArr[t];this.$set(this,"selectSku",i);var o=i.suk.split(",");o.forEach((function(t,i){e.$set(e.attribute.productAttr[i],"index",o[i])})),i&&(this.$set(this.attribute.productSelect,"image",i.image),this.$set(this.attribute.productSelect,"price",i.price),this.$set(this.attribute.productSelect,"stock",i.stock),this.$set(this.attribute.productSelect,"unique",i.unique),this.$set(this.attribute.productSelect,"cart_num",1),this.$set(this.attribute.productSelect,"quota",i.quota),this.$set(this.attribute.productSelect,"quota_show",i.quota_show),this.$set(this,"attrValue",i.suk),this.attrTxt="已选择")},qrR:function(t){},getpreviewImage:function(){if(this.posterImage){var e=[];e.push(this.posterImage),t.previewImage({urls:e,current:this.posterImage})}else his.$util.Tips({title:"您的海报尚未生成"})},showAll:function(){this.AllIndexDefault=this.AllIndex,this.AllIndex=this.pink.length},hideAll:function(){this.AllIndex=this.AllIndexDefault},authColse:function(t){this.isShowAuth=t},iptCartNum:function(t){this.$set(this.attribute.productSelect,"cart_num",t),this.$set(this,"cart_num",t)},returns:function(){return t.navigateBack({delta:1})},combinationDetail:function(){var e=this,i=e.id;(0,n.getCombinationDetail)(i).then((function(i){for(var o in e.dataShow=1,t.setNavigationBarTitle({title:i.data.storeInfo.title.substring(0,16)}),e.imgUrls=i.data.storeInfo.images,e.posterTitle=i.data.product_poster_title,e.storeInfo=i.data.storeInfo,e.storeInfo.description=e.storeInfo.description.replace(/<img/gi,'<img style="max-width:100%;height:auto;float:left;display:block" '),e.attribute.productSelect.num=i.data.storeInfo.num,e.pink=i.data.pink,e.pindAll=i.data.pindAll,e.reply=i.data.reply,e.replyCount=i.data.replyCount,e.itemNew=i.data.pink_ok_list,e.pink_ok_sum=i.data.pink_ok_sum,e.replyChance=i.data.replyChance,e.attribute.productAttr=i.data.productAttr,e.productValue=i.data.productValue,e.shareQrcode=i.data.share_qrcode,i.data.productValue){var s=i.data.productValue[o];e.skuArr.push(s)}e.selectSku=e.skuArr[0],e.routineContact=Number(i.data.routine_contact_type),e.siteName=i.data.site_name;var n=["商品","详情"];i.data.replyCount&&n.splice(1,0,"评价"),e.$set(e,"navList",n),e.downloadFilestoreImage(),e.DefaultSelect(),setTimeout((function(){e.infoScroll()}),500),setTimeout((function(){e.showSkeleton=!1}),300)})).catch((function(t){e.$util.Tips({title:t},{tab:3})}))},DefaultSelect:function(){var t=this.attribute.productAttr,e=[];for(var i in this.productValue)if(this.productValue[i].quota>0){e=this.attribute.productAttr.length?i.split(","):[];break}for(var o=0;o<t.length;o++)this.$set(t[o],"index",e[o]);var s=this.productValue[e.join(",")];s&&t.length?(this.$set(this.attribute.productSelect,"store_name",this.storeInfo.title),this.$set(this.attribute.productSelect,"image",s.image),this.$set(this.attribute.productSelect,"price",s.price),this.$set(this.attribute.productSelect,"stock",s.stock),this.$set(this.attribute.productSelect,"unique",s.unique),this.$set(this.attribute.productSelect,"quota",s.quota),this.$set(this.attribute.productSelect,"quota_show",s.quota_show),this.$set(this.attribute.productSelect,"product_stock",s.product_stock),this.$set(this.attribute.productSelect,"cart_num",1),this.$set(this,"attrValue",e.join(",")),this.attrValue=e.join(",")):!s&&t.length?(this.$set(this.attribute.productSelect,"store_name",this.storeInfo.title),this.$set(this.attribute.productSelect,"image",this.storeInfo.image),this.$set(this.attribute.productSelect,"price",this.storeInfo.price),this.$set(this.attribute.productSelect,"quota",0),this.$set(this.attribute.productSelect,"quota_show",0),this.$set(this.attribute.productSelect,"product_stock",0),this.$set(this.attribute.productSelect,"stock",0),this.$set(this.attribute.productSelect,"unique",""),this.$set(this.attribute.productSelect,"cart_num",0),this.$set(this,"attrValue",""),this.$set(this,"attrTxt","请选择")):s||t.length||(this.$set(this.attribute.productSelect,"store_name",this.storeInfo.title),this.$set(this.attribute.productSelect,"image",this.storeInfo.image),this.$set(this.attribute.productSelect,"price",this.storeInfo.price),this.$set(this.attribute.productSelect,"stock",this.storeInfo.stock),this.$set(this.attribute.productSelect,"quota",0),this.$set(this.attribute.productSelect,"product_stock",0),this.$set(this.attribute.productSelect,"unique",this.storeInfo.unique||""),this.$set(this.attribute.productSelect,"cart_num",1),this.$set(this,"attrValue",""),this.$set(this,"attrTxt","请选择"))},infoScroll:function(){for(var e=this,i=[],o=[],s=0;s<e.navList.length;s++){var n=t.createSelectorQuery().in(this),r="#past"+s;this.replyCount||1!=s||(r="#past2"),n.select(r).boundingClientRect(),n.exec((function(t){var s=t[0].top,n=t[0].height;i.push(s),o.push(n),e.topArr=i,e.heightArr=o}))}},onLoadFun:function(){this.downloadFilePromotionCode(),this.isShowAuth=!1},selecAttr:function(){this.currentPage=!1,this.attribute.cartAttr=!0},onMyEvent:function(){this.$set(this.attribute,"cartAttr",!1),this.$set(this,"isOpen",!1)},ChangeCartNum:function(t){var e=this.productValue[this.attrValue];if(this.cart_num&&(e.cart_num=this.cart_num,this.attribute.productSelect.cart_num=this.cart_num),void 0!==e||this.attribute.productAttr.length||(e=this.attribute.productSelect),void 0!==e){e.stock,e.quota_show;var i=e.quota||0,o=e.product_stock||0,s=this.attribute.productSelect,n=this.storeInfo.num||0;if(void 0==e.cart_num&&(e.cart_num=1),t){s.cart_num++;var r=[];r.push(n),r.push(i),r.push(o);var a=Math.min.apply(null,r);s.cart_num>=a&&(this.$set(this.attribute.productSelect,"cart_num",a||1),this.$set(this,"cart_num",a||1)),this.$set(this,"cart_num",s.cart_num),this.$set(this.attribute.productSelect,"cart_num",s.cart_num)}else s.cart_num--,s.cart_num<1&&(this.$set(this.attribute.productSelect,"cart_num",1),this.$set(this,"cart_num",1)),this.$set(this,"cart_num",s.cart_num),this.$set(this.attribute.productSelect,"cart_num",s.cart_num)}},attrVal:function(t){this.attribute.productAttr[t.indexw].index=this.attribute.productAttr[t.indexw].attr_values[t.indexn]},ChangeAttr:function(t){this.$set(this,"cart_num",1);var e=this.productValue[t];this.$set(this,"selectSku",e),e?(this.$set(this.attribute.productSelect,"image",e.image),this.$set(this.attribute.productSelect,"price",e.price),this.$set(this.attribute.productSelect,"stock",e.stock),this.$set(this.attribute.productSelect,"unique",e.unique),this.$set(this.attribute.productSelect,"cart_num",1),this.$set(this.attribute.productSelect,"quota",e.quota),this.$set(this.attribute.productSelect,"quota_show",e.quota_show),this.$set(this,"attrValue",t),this.attrTxt="已选择"):(this.$set(this.attribute.productSelect,"image",this.storeInfo.image),this.$set(this.attribute.productSelect,"price",this.storeInfo.price),this.$set(this.attribute.productSelect,"stock",0),this.$set(this.attribute.productSelect,"unique",""),this.$set(this.attribute.productSelect,"cart_num",0),this.$set(this.attribute.productSelect,"quota",0),this.$set(this.attribute.productSelect,"quota_show",0),this.$set(this,"attrValue",""),this.attrTxt="已选择")},goProduct:(0,l.Debounce)((function(){t.navigateTo({url:"/pages/goods_details/index?id="+this.storeInfo.product_id})})),goCat:function(){if(this.isLogin){var e=this;e.currentPage=!1;var i=this.productValue[this.attrValue];if(this.isOpen?this.attribute.cartAttr=!0:this.attribute.cartAttr=!this.attribute.cartAttr,!0===this.attribute.cartAttr&&0==this.isOpen)return this.isOpen=!0;if(this.attribute.productAttr.length&&void 0===i&&1==this.isOpen)return e.$util.Tips({title:"请选择属性"});var o={productId:e.storeInfo.product_id,secKillId:0,bargainId:0,combinationId:e.id,cartNum:e.cart_num,uniqueId:void 0!==i?i.unique:"",is_new:1};(0,r.postCartAdd)(o).then((function(i){e.isOpen=!1,t.navigateTo({url:"/pages/goods/order_confirm/index?new=1&cartId="+i.data.cartId})})).catch((function(e){t.showToast({title:e,icon:"none"})}))}else this.getIsLogin()},setCollect:(0,l.Debounce)((function(){var t=this;this.isLogin?this.storeInfo.userCollect?(0,r.collectDel)(this.storeInfo.product_id).then((function(e){t.storeInfo.userCollect=!t.storeInfo.userCollect})):(0,r.collectAdd)(this.storeInfo.product_id).then((function(e){t.storeInfo.userCollect=!t.storeInfo.userCollect})):this.getIsLogin()})),listenerActionSheet:function(){this.currentPage=!1,0==this.isLogin?getIsLogin():(this.posters=!0,this.goPoster())},posterImageClose:function(){this.posterImageStatus=!1,this.posters=!1},setDomain:function(t){return t=t?t.toString():"",t.indexOf("https://")>-1?t:t.replace("http://","https://")},downloadFilestoreImage:function(){var e=this;t.downloadFile({url:e.setDomain(e.storeInfo.image),success:function(t){e.storeImage=t.tempFilePath,e.base64Show=1},fail:function(){return e.$util.Tips({title:""})}})},downloadFilePromotionCode:function(e){var i=this;(0,n.scombinationCode)(i.id).then((function(o){t.downloadFile({url:i.setDomain(o.data.code),success:function(t){i.$set(i,"isDown",!1),"function"==typeof e?e&&e(t.tempFilePath):i.$set(i,"PromotionCode",t.tempFilePath)},fail:function(){i.$set(i,"isDown",!1),i.$set(i,"PromotionCode","")}})})).catch((function(t){i.$set(i,"isDown",!1),i.$set(i,"PromotionCode","")}))},getImageBase64:function(t){var e=this;(0,a.imageBase64)(e.storeImage,e.followCode).then((function(i){e.storeImage=i.data.image,t&&(e.PromotionCode=i.data.code),e.base64Show=1})).catch((function(){}))},goPoster:function(){var e=this;e.$set(e,"canvasStatus",!0);var i=[e.posterbackgd,e.storeImage,e.PromotionCode];return""!=e.PromotionCode||e.isDown?e.isDown?e.$util.Tips({title:"正在下载海报,请稍后再试！"},(function(){e.posters=!1})):void t.getImageInfo({src:e.PromotionCode,fail:function(t){return e.$util.Tips({title:"小程序二维码需要发布正式版后才能获取到"})},success:function(){""==i[2]?e.downloadFilePromotionCode((function(t){if(i[2]=t,""==i[2])return e.$util.Tips({title:"海报二维码生成失败！"});e.$nextTick((function(){e.$util.PosterCanvas(e.fontColor,e.themeColor,e.siteName,i,e.storeInfo.title,e.storeInfo.price,e.storeInfo.product_price,e.posterTitle,(function(t){e.$set(e,"posterImage",t),e.$set(e,"posterImageStatus",!0),e.$set(e,"canvasStatus",!1),e.$set(e,"actionSheetHidden",!e.actionSheetHidden)}))}))})):e.$nextTick((function(){e.$util.PosterCanvas(e.fontColor,e.themeColor,e.siteName,i,e.storeInfo.title,e.storeInfo.price,e.storeInfo.product_price,e.posterTitle,(function(t){e.$set(e,"posterImage",t),e.$set(e,"posterImageStatus",!0),e.$set(e,"canvasStatus",!1),e.$set(e,"actionSheetHidden",!e.actionSheetHidden)}))}))}}):e.$util.Tips({title:"小程序二维码需要发布正式版后才能获取到"},(function(){e.posters=!1}))},savePosterPath:function(){var e=this;t.getSetting({success:function(i){i.authSetting["scope.writePhotosAlbum"]?t.saveImageToPhotosAlbum({filePath:e.posterImage,success:function(t){e.posterImageClose(),e.$util.Tips({title:"保存成功",icon:"success"})},fail:function(t){e.$util.Tips({title:"保存失败"})}}):t.authorize({scope:"scope.writePhotosAlbum",success:function(){t.saveImageToPhotosAlbum({filePath:e.posterImage,success:function(t){e.posterImageClose(),e.$util.Tips({title:"保存成功",icon:"success"})},fail:function(t){e.$util.Tips({title:"保存失败"})}})}})}})},scroll:function(t){var e=t.detail.scrollTop,i=e/200;if(i=i>1?1:i,this.opacity=i,this.scrollY=e,this.currentPage=!1,this.lock)this.lock=!1;else for(var o=0;o<this.topArr.length;o++)if(e<this.topArr[o]-h.globalData.navHeight/2+this.heightArr[o]){this.navActive=o;break}},tap:function(t,e){var i=t.id;e=e;this.replyCount||"past1"!=i||(i="past2"),this.toView=i,this.navActive=e,this.lock=!0,this.scrollTop=e>0?this.topArr[e]-h.globalData.navHeight/2:this.topArr[e]}},onShareAppMessage:function(){return{title:this.storeInfo.title,path:h.globalData.openPages,imageUrl:this.storeInfo.image}},onShareTimeline:function(){return{title:this.storeInfo.title,path:h.globalData.openPages,imageUrl:this.storeInfo.image}}};e.default=p}).call(this,i("543d")["default"])},a08d:function(t,e,i){"use strict";i.r(e);var o=i("d87a"),s=i("d6b3");for(var n in s)["default"].indexOf(n)<0&&function(t){i.d(e,t,(function(){return s[t]}))}(n);i("5719");var r=i("f0c5"),a=Object(r["a"])(s["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],void 0);e["default"]=a.exports},cb3d:function(t,e,i){"use strict";(function(t,e){var o=i("4ea4");i("8824");o(i("66fd"));var s=o(i("a08d"));t.__webpack_require_UNI_MP_PLUGIN__=i,e(s.default)}).call(this,i("bc2e")["default"],i("543d")["createPage"])},d6b3:function(t,e,i){"use strict";i.r(e);var o=i("7bda"),s=i.n(o);for(var n in o)["default"].indexOf(n)<0&&function(t){i.d(e,t,(function(){return o[t]}))}(n);e["default"]=s.a},d87a:function(t,e,i){"use strict";i.d(e,"b",(function(){return s})),i.d(e,"c",(function(){return n})),i.d(e,"a",(function(){return o}));var o={jyfParser:function(){return Promise.all([i.e("common/vendor"),i.e("components/jyf-parser/jyf-parser")]).then(i.bind(null,"217b"))}},s=function(){var t=this,e=t.$createElement,i=(t._self._c,t.attribute.productAttr.length&&(t.attribute.productAttr.length?t.attribute.productAttr[0].attr_values.length:0)>1),o=t.storeInfo.brand_name&&t.storeInfo.brand_name.trim(),s=t.attribute.productAttr.length,n=s?t.skuArr.length:null,r=s&&n>1?t.skuArr.slice(0,4):null,a=s&&n>1?t.skuArr.length:null,u=t.itemNew.length,c=t.pink.length,l=c?t.pink.length:null,h=!c||l>t.AllIndex?null:t.pink.length===t.AllIndex&&t.pink.length!==t.AllIndexDefault;t._isMounted||(t.e0=function(e){t.H5ShareBox=!1}),t.$mp.data=Object.assign({},{$root:{g0:i,g1:o,g2:s,g3:n,l0:r,g4:a,g5:u,g6:c,g7:l,g8:h}})},n=[]}},[["cb3d","common/runtime","common/vendor"]]]);
(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/activity/poster-poster/index"],{"1f8a":function(t,e,n){"use strict";var i=n("3e9a"),o=n.n(i);o.a},"3e9a":function(t,e,n){},"4c97":function(t,e,n){"use strict";n.r(e);var i=n("95fe"),o=n("e47b");for(var a in o)["default"].indexOf(a)<0&&function(t){n.d(e,t,(function(){return o[t]}))}(a);n("1f8a");var s=n("f0c5"),r=Object(s["a"])(o["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],void 0);e["default"]=r.exports},"56a3":function(t,e,n){"use strict";(function(t,e){var i=n("4ea4");n("8824");i(n("66fd"));var o=i(n("4c97"));t.__webpack_require_UNI_MP_PLUGIN__=n,e(o.default)}).call(this,n("bc2e")["default"],n("543d")["createPage"])},"80a7":function(t,e,n){"use strict";(function(t){var i=n("4ea4");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=i(n("2eee")),a=i(n("c973")),s=n("3995"),r=n("99c8"),c=i(n("a29e")),u={components:{zbCode:function(){Promise.all([n.e("common/vendor"),n.e("components/zb-code/zb-code")]).then(function(){return resolve(n("0657"))}.bind(null,n)).catch(n.oe)}},mixins:[c.default],data:function(){return{canvasStatus:!0,posterImage:"",parameter:{navbar:"1",return:"1",title:"拼团海报",color:!0,class:"0"},type:0,id:0,spid:0,image:"",from:"",uid:"",codeShow:!1,cid:"1",ifShow:!0,val:"",size:200,unit:"upx",background:"#FFF",foreground:"#000",pdground:"#000",icon:"",iconsize:40,lv:3,onval:!0,loadMake:!0,src:"",codeSrc:"",wd:0,hg:0,posterBag:"../static/posterBag.png",mpUrl:""}},onLoad:function(e){this.from="routine";if(!e.hasOwnProperty("type")||!e.hasOwnProperty("id"))return app.Tips({title:"参数错误",icon:"none"},{tab:3,url:1});this.type=e.type,this.id=e.id,1==e.type?(this.spid=e.spid,t.setNavigationBarTitle({title:"砍价海报"})):t.setNavigationBarTitle({title:"拼团海报"})},onReady:function(){var e=this;setTimeout((function(t){e.getPosterInfo()}),200),this.$nextTick((function(){var e=this,n=t.createSelectorQuery().select(".pictrue");n.fields({size:!0},(function(t){e.wd=t.width,e.hg=t.height})).exec()}))},onShow:function(){t.removeStorageSync("form_type_cart")},methods:{getPosterInfo:function(){var e=this;return(0,a.default)(o.default.mark((function n(){var i,a,c,u,l,f;return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return i=e,"",{id:i.id,from:i.from},n.next=4,(0,r.getUserInfo)();case 4:if(a=n.sent,e.uid=a.data.uid,t.showLoading({title:"海报生成中",mask:!0}),f=!1,1!=i.type){n.next=13;break}return n.next=11,(0,s.getBargainPosterData)(i.id).then((function(t){c=t.data})).catch((function(t){f=!0,i.$util.Tips({title:t},"/pages/activity/goods_bargain/index")}));case 11:n.next=15;break;case 13:return n.next=15,(0,s.getCombinationPosterData)(i.id).then((function(t){c=t.data})).catch((function(t){f=!0,i.$util.Tips({title:"海报图片获取失败"})}));case 15:if(!f){n.next=17;break}return n.abrupt("return",!1);case 17:return n.next=19,e.downloadFilestoreImage(c.url);case 19:return l=n.sent,n.t0=e.posterBag,n.next=23,e.downloadFilestoreImage(c.image);case 23:n.t1=n.sent,n.t2=l,u=[n.t0,n.t1,n.t2],e.$nextTick((function(t){i.$util.bargainPosterCanvas(u,c.title,c.label,c.msg,c.price,e.wd,e.hg,(function(t){e.posterImage=t}))}));case 27:case"end":return n.stop()}}),n)})))()},downloadFilestoreImage:function(e){var n=this;return e=this.setDomain(e),new Promise((function(i,o){var a=n;t.downloadFile({url:e,success:function(t){i(t.tempFilePath)},fail:function(){return a.$util.Tips({title:""})}})}))},setDomain:function(t){return t=t?t.toString():"",t.indexOf("https://")>-1?t:t.replace("http://","https://")},imgToBase:function(t){return(0,a.default)(o.default.mark((function e(){var n;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,r.imgToBase)({image:t});case 2:return n=e.sent,e.abrupt("return",n.data.image);case 4:case"end":return e.stop()}}),e)})))()},downloadImg:function(){},savePosterPathMp:function(e){var n=this;t.getSetting({success:function(i){i.authSetting["scope.writePhotosAlbum"]?t.saveImageToPhotosAlbum({filePath:e,success:function(t){n.$util.Tips({title:"保存成功",icon:"success"})},fail:function(t){n.$util.Tips({title:"保存失败"})}}):t.authorize({scope:"scope.writePhotosAlbum",success:function(){t.saveImageToPhotosAlbum({filePath:e,success:function(t){n.$util.Tips({title:"保存成功",icon:"success"})},fail:function(t){n.$util.Tips({title:"保存失败"})}})},fail:function(t){n.$util.Tips({title:"请先开启文件访问权限"})}})}})},qrR:function(t){this.codeSrc=t},savePosterPath:function(){var e=this;t.getSetting({success:function(n){n.authSetting["scope.writePhotosAlbum"]?t.saveImageToPhotosAlbum({filePath:e.posterImage,success:function(t){e.posterImageClose(),e.$util.Tips({title:"保存成功",icon:"success"})},fail:function(t){e.$util.Tips({title:"保存失败"})}}):t.authorize({scope:"scope.writePhotosAlbum",success:function(){t.saveImageToPhotosAlbum({filePath:e.posterImage,success:function(t){e.posterImageClose(),e.$util.Tips({title:"保存成功",icon:"success"})},fail:function(t){e.$util.Tips({title:"保存失败"})}})}})}})}}};e.default=u}).call(this,n("543d")["default"])},"95fe":function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return o})),n.d(e,"a",(function(){}));var i=function(){var t=this.$createElement;this._self._c},o=[]},e47b:function(t,e,n){"use strict";n.r(e);var i=n("80a7"),o=n.n(i);for(var a in i)["default"].indexOf(a)<0&&function(t){n.d(e,t,(function(){return i[t]}))}(a);e["default"]=o.a}},[["56a3","common/runtime","common/vendor"]]]);
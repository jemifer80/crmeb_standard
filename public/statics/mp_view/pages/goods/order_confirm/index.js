require('../common/vendor.js');(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/goods/order_confirm/index"],{2152:function(t,e,i){"use strict";var n=i("570b"),s=i.n(n);s.a},"4a85":function(t,e,i){"use strict";i.r(e);var n=i("64d5"),s=i.n(n);for(var a in n)["default"].indexOf(a)<0&&function(t){i.d(e,t,(function(){return n[t]}))}(a);e["default"]=s.a},"54d8":function(t,e,i){"use strict";i.d(e,"b",(function(){return n})),i.d(e,"c",(function(){return s})),i.d(e,"a",(function(){}));var n=function(){var t=this,e=t.$createElement,i=(t._self._c,0==t.product_type&&0!=t.shippingType?t.storeList.length:null),n=t.confirm.length,s=n?t.__map(t.confirm,(function(e,i){var n=t.__get_orig(e),s="img"==e.label?e.value.length:null;return{$orig:n,g2:s}})):null,a=t.priceGroup.storePostage>0?(parseFloat(t.priceGroup.storePostage)+parseFloat(t.priceGroup.storePostageDiscount)).toFixed(2):null,o=!(t.priceGroup.vipPrice>0&&t.userInfo.vip)||t.pinkId||t.BargainId||t.combinationId||t.seckillId||t.discountId?null:parseFloat(t.priceGroup.vipPrice).toFixed(2),r=t.priceGroup.storePostageDiscount>0?parseFloat(t.priceGroup.storePostageDiscount).toFixed(2):null,c=t.coupon_price>0?parseFloat(t.coupon_price).toFixed(2):null,d=t.integral_price>0?parseFloat(t.integral_price).toFixed(2):null,u=t.__map(t.promotions_detail,(function(e,i){var n=t.__get_orig(e),s=parseFloat(e.promotions_price),a=s?parseFloat(e.promotions_price).toFixed(2):null;return{$orig:n,m0:s,g8:a}})),p=(t.valid_count>0&&!t.discount_id||t.valid_count==t.cartInfo.length&&t.discount_id)&&t.shippingType||!t.shippingType&&t.addressId||0!=t.product_type,l=t.totalPrice.toString();t.$mp.data=Object.assign({},{$root:{g0:i,g1:n,l0:s,g3:a,g4:o,g5:r,g6:c,g7:d,l1:u,g9:p,g10:l}})},s=[]},"570b":function(t,e,i){},"64d5":function(t,e,i){"use strict";(function(t){var n=i("4ea4");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=i("79c7"),a=i("99c8"),o=i("aed8"),r=i("78a2"),c=(i("0cf1"),i("d5f7"),i("26cb")),d=n(i("a29e")),u={components:{payment:function(){Promise.all([i.e("common/vendor"),i.e("components/payment/index")]).then(function(){return resolve(i("fb96"))}.bind(null,i)).catch(i.oe)},invoicePicker:function(){i.e("pages/goods/components/invoicePicker/index").then(function(){return resolve(i("74a09"))}.bind(null,i)).catch(i.oe)},couponListWindow:function(){Promise.all([i.e("common/vendor"),i.e("components/couponListWindow/index")]).then(function(){return resolve(i("717c"))}.bind(null,i)).catch(i.oe)},addressWindow:function(){i.e("components/addressWindow/index").then(function(){return resolve(i("191f"))}.bind(null,i)).catch(i.oe)},orderGoods:function(){i.e("components/orderGoods/index").then(function(){return resolve(i("7325"))}.bind(null,i)).catch(i.oe)},home:function(){Promise.all([i.e("common/vendor"),i.e("components/home/index")]).then(function(){return resolve(i("d878"))}.bind(null,i)).catch(i.oe)}},mixins:[d.default],data:function(){return{giveData:{give_integral:0,give_coupon:[]},giveCartInfo:[],confirm:[],id:0,isaddress:!1,textareaStatus:!0,cartArr:[{name:"微信支付",icon:"icon-weixin2",value:"weixin",title:"使用微信快捷支付",payStatus:1},{name:"支付宝支付",icon:"icon-zhifubao",value:"alipay",title:"使用线上支付宝支付",payStatus:1},{name:"余额支付",icon:"icon-yuezhifu",value:"yue",title:"可用余额:",payStatus:1},{name:"线下支付",icon:"icon-yuezhifu1",value:"offline",title:"选择线下付款方式",payStatus:2}],formContent:"",payType:"weixin",openType:1,active:0,coupon:{coupon:!1,list:[],statusTile:"立即使用"},address:{address:!1},addressInfo:{},pinkId:0,addressId:0,couponId:0,cartId:"",BargainId:0,combinationId:0,seckillId:0,discountId:0,userInfo:{},mark:"",couponTitle:"请选择",coupon_price:0,promotions_detail:[],useIntegral:!1,integral_price:0,integral:0,ChangePrice:0,formIds:[],status:0,is_address:!1,toPay:!1,shippingType:0,system_store:{},storePostage:0,contacts:"",contactsTel:"",mydata:{},storeList:[],store_self_mention:0,cartInfo:[],priceGroup:{},animated:!1,totalPrice:0,integralRatio:"0",pagesUrl:"",orderKey:"",offlinePostage:"",isAuto:!1,isShowAuth:!1,from:"",news:1,invTitle:"不开发票",special_invoice:!1,invoice_func:!1,integral_ratio_status:1,header_type:"",invShow:!1,invList:[],invChecked:"",urlQuery:"",pay_close:!1,noCoupon:0,valid_count:0,discount_id:0,storeId:0,product_type:1,newImg:[],isDisplay:0,goodsType:0}},computed:(0,c.mapGetters)(["isLogin"]),onLoad:function(t){if(this.from="routine",!t.cartId)return this.$util.Tips({title:"请选择要购买的商品"},{tab:3,url:1});switch(this.couponId=t.couponId||0,this.noCoupon=t.noCoupon||0,this.pinkId=t.pinkId?parseInt(t.pinkId):0,this.addressId=t.addressId||0,this.cartId=t.cartId,this.is_address=!!t.is_address,this.news=t.new&&"0"!==t.new?1:0,this.invChecked=t.invoice_id||"",this.header_type=t.header_type||"1",this.couponTitle=t.couponTitle||"请选择",t.invoice_type){case"1":this.invTitle="增值税电子普通发票";break;case"2":this.invTitle="增值税电子专用发票";break}t.invoice_name&&(this.invTitle=t.invoice_name),this.textareaStatus=!0,this.isLogin&&0==this.toPay?this.getCheckShipping():this.isShowAuth=!0},onShow:function(){var e=this;t.$on("handClick",(function(i){i&&(e.system_store=i.address,e.storeId=e.system_store.id,e.cartId=i.cartId,e.news=i.new,e.pinkId=Number(i.pinkId),e.couponId=i.couponId,e.getConfirm()),t.$off("handClick")}))},methods:{authColse:function(t){this.isShowAuth=t},getCheckShipping:function(){var e=this,i={cartId:this.cartId,new:this.news};(0,s.checkShipping)(i).then((function(t){e.isDisplay=t.data.type,2==e.isDisplay?e.addressType(1):(e.getaddressInfo(),e.getConfirm(),e.$nextTick((function(){this.$refs.addressWindow.getAddressList()})))})).catch((function(e){t.showToast({title:e,icon:"none"})}))},DelPic:function(t,e){this.confirm[t].value;this.confirm[t].value.splice(e,1),this.$set(this.confirm[t],"value",this.confirm[t].value)},uploadpic:function(t){var e=this;this.$util.uploadImageOne("upload/image",(function(i){e.newImg.push(i.data.url),e.$set(e.confirm[t],"value",e.newImg)}))},invCancel:function(){this.invChecked="",this.invTitle="不开发票",this.invShow=!1},invChange:function(t){this.invChecked=t,this.invShow=!1;var e=this.invList.find((function(e){return e.id===t})),i="";i+=1===e.header_type?"个人":"企业",i+=1===e.type?"普通":"专用",i+="发票",this.invTitle=i},invClose:function(){this.invShow=!1,this.getInvoiceList()},getInvoiceList:function(){var e=this;t.showLoading({title:"正在加载…"}),(0,a.invoiceList)().then((function(i){t.hideLoading(),e.invList=i.data.map((function(t){return t.id=t.id.toString(),t}));var n=e.invList.find((function(t){return t.id==e.invChecked}));if(n){var s="";s+=1===n.header_type?"个人":"企业",s+=1===n.type?"普通":"专用",s+="发票",e.invTitle=s}})).catch((function(e){t.showToast({title:e,icon:"none"})}))},goInvoice:function(){this.getInvoiceList(),this.invShow=!0,this.urlQuery="new=".concat(this.news,"&cartId=").concat(this.cartId,"&pinkId=").concat(this.pinkId,"&couponId=").concat(this.couponId,"&addressId=").concat(this.addressId,"&specialInvoice=").concat(this.special_invoice,"&couponTitle=").concat(this.couponTitle)},onLoadFun:function(){this.getCheckShipping(),this.isShowAuth=!1},onChangeFun:function(t){var e=t,i=e.action||null,n=void 0!=e.value?e.value:null;i&&this[i]&&this[i](n)},payClose:function(){this.pay_close=!1},goPay:function(){this.pay_close=!0},payCheck:function(t){this.payType=t,this.SubOrder()},payAddress:function(){t.navigateTo({url:"/pages/users/user_address/index?id="+this.id+"&new="+this.news+"&cartId="+this.cartId+"&pinkId="+this.pinkId+"&couponId="+this.couponId})},getList:function(){var t=this;(0,r.storeListApi)({page:1,limit:10}).then((function(e){var i=e.data.list.list||[];t.$set(t,"storeList",i),t.$set(t,"system_store",i[0]),t.$set(t,"storeId",i[0].id),t.getConfirm()})).catch((function(t){}))},changeClose:function(){this.$set(this.address,"address",!1)},changePayType:function(t){this.payType=t,this.computedPrice()},computedPrice:function(){var t=this,e=this.shippingType;(0,s.postOrderComputed)(this.orderKey,{addressId:this.addressId,useIntegral:this.useIntegral?1:0,couponId:0==this.priceGroup.couponPrice?0:this.couponId,shipping_type:parseInt(e)+1,payType:this.payType}).then((function(i){var n=i.data.result;n&&(t.totalPrice=n.pay_price,t.integral_price=n.deduction_price,t.coupon_price=n.coupon_price,t.promotions_detail=n.promotions_detail,t.integral=t.useIntegral?n.SurplusIntegral:t.userInfo.integral,t.$set(t.priceGroup,"storePostage",1==e?0:n.pay_postage),t.$set(t.priceGroup,"storePostageDiscount",n.storePostageDiscount))})).catch((function(t){return that.$util.Tips({title:t})}))},addressType:function(t){var e=t;this.shippingType=parseInt(e),1==e?this.getList():this.getConfirm()},bindPickerChange:function(t){var e=t.detail.value;this.shippingType=e,this.computedPrice()},ChangCouponsClone:function(){this.$set(this.coupon,"coupon",!1)},changeTextareaStatus:function(){for(var t=0,e=this.coupon.list.length;t<e;t++)this.coupon.list[t].use_title="",this.coupon.list[t].is_use=0;this.textareaStatus=!0,this.status=0,this.$set(this.coupon,"list",this.coupon.list)},ChangCoupons:function(t){for(var e=t,i=this.coupon.list,n="请选择",s=0,a=0,o=i.length;a<o;a++)a!=e&&(i[a].use_title="",i[a].is_use=0);i[e].is_use?(i[e].use_title="",i[e].is_use=0):(i[e].use_title="不使用",i[e].is_use=1,n=i[e].coupon_title,s=i[e].id),this.couponTitle=n,this.couponId=s,this.$set(this.coupon,"coupon",!1),this.$set(this.coupon,"list",i),this.getConfirm(1)},ChangeIntegral:function(){this.useIntegral=!this.useIntegral,this.computedPrice()},OnChangeAddress:function(t){this.textareaStatus=!0,this.addressId=t,this.address.address=!1,this.getConfirm(),this.getaddressInfo(),this.computedPrice()},bindHideKeyboard:function(t){this.mark=t.detail.value},getConfirm:function(t){var e,i=this,n=this,a=parseInt(this.shippingType)+1,o=0;1==a?(o=n.addressId,e=0):(o="",e=n.storeId),(0,s.orderConfirm)(n.cartId,n.news,o,a,e,n.couponId).then((function(e){1==e.data.upgrade_addr&&(n.id=e.data.addressInfo.id,i.isaddress=!0),1!=t&&n.$set(n,"confirm",e.data.custom_form),n.$set(n,"goodsType",e.data.type),n.$set(n,"userInfo",e.data.userInfo),n.$set(n,"integral",e.data.userInfo.integral),n.$set(n,"contacts",e.data.userInfo.real_name),n.$set(n,"contactsTel",e.data.userInfo.record_phone||""),n.$set(n,"integralRatio",e.data.integralRatio),n.$set(n,"offlinePostage",e.data.offlinePostage),n.$set(n,"orderKey",e.data.orderKey),n.$set(n,"valid_count",e.data.valid_count),n.$set(n,"discount_id",e.data.discount_id),n.$set(n,"priceGroup",e.data.priceGroup),n.$set(n,"seckillId",parseInt(e.data.seckill_id)),n.$set(n,"BargainId",parseInt(e.data.bargain_id)),n.$set(n,"combinationId",parseInt(e.data.combination_id)),n.$set(n,"discountId",parseInt(e.data.discount_id)),n.$set(n,"invoice_func",e.data.invoice_func),n.$set(n,"integral_ratio_status",e.data.integral_ratio_status),n.$set(n,"special_invoice",e.data.special_invoice),n.$set(n,"store_self_mention",e.data.store_self_mention),n.giveData.give_integral=e.data.give_integral,n.giveData.give_coupon=e.data.give_coupon;var s=e.data.cartInfo,a=[],o=[];s.forEach((function(t){1==t.is_gift?o.push(t):a.push(t)})),n.$set(n,"cartInfo",a),n.$set(n,"giveCartInfo",o);var r=-1;o.forEach((function(t){if(0==t.product_type)return r=0})),n.$set(n,"product_type",0==e.data.product_type||0==r?0:1),n.cartArr[0].payStatus=e.data.pay_weixin_open||0,n.cartArr[1].payStatus=e.data.ali_pay_status||0,n.cartArr[1].payStatus=0,n.cartArr[2].number=e.data.userInfo.now_money,n.cartArr[2].payStatus=1==e.data.yue_pay_status?e.data.yue_pay_status:0,2==e.data.offline_pay_status?n.cartArr[3].payStatus=0:n.cartArr[3].payStatus=1,n.$set(n,"ChangePrice",n.totalPrice),n.getBargainId(),n.getCouponList(),n.computedPrice(),i.addressId||i.couponId||n.$set(n,"totalPrice",n.$util.$h.Add(parseFloat(e.data.priceGroup.totalPrice),parseFloat(e.data.priceGroup.storePostage)))})).catch((function(t){return i.$util.Tips({title:t})}))},getBargainId:function(){3==this.cartArr.length&&(this.BargainId||this.combinationId||this.seckillId||this.discountId)&&(this.cartArr[2].payStatus=0,this.$set(this,"cartArr",this.cartArr))},getCouponList:function(){var t=this,e={cartId:this.cartId,new:this.news,shipping_type:t.$util.$h.Add(t.shippingType,1),store_id:t.system_store?t.system_store.id:0};(0,s.getCouponsOrderPrice)(this.totalPrice,e).then((function(e){t.$set(t.coupon,"list",e.data),t.openType=1}))},getaddressInfo:function(){var t=this;t.addressId?(0,a.getAddressDetail)(t.addressId).then((function(e){e.data.is_default=parseInt(e.data.is_default),t.addressInfo=e.data||{},t.addressId=e.data.id||0,t.address.addressId=e.data.id||0})):(0,a.getAddressDefault)().then((function(e){e.data.is_default=parseInt(e.data.is_default),t.addressInfo=e.data||{},t.addressId=e.data.id||0,t.address.addressId=e.data.id||0}))},payItem:function(t){var e=this,i=t;e.active=i,e.animated=!0,e.payType=e.cartArr[i].value,e.computedPrice(),setTimeout((function(){e.car()}),500)},couponTap:function(){var t=this;this.coupon.coupon=!0,this.coupon.list.forEach((function(e,i){e.id==t.couponId?e.is_use=1:e.is_use=0})),this.$set(this.coupon,"list",this.coupon.list)},car:function(){this.animated=!1},onAddress:function(e){e?(this.textareaStatus=!1,this.address.address=!0,this.pagesUrl="/pages/users/user_address_list/index?news="+this.news+"&cartId="+this.cartId+"&pinkId="+this.pinkId+"&couponId="+this.couponId):t.navigateTo({url:"/pages/users/user_address/index?new="+this.news+"&cartId="+this.cartId+"&pinkId="+this.pinkId+"&couponId="+this.couponId})},payment:function(e){var i=this,n=this;(0,s.orderCreate)(n.orderKey,e).then((function(e){var s=e.data.status,a=e.data.result.orderId,o=e.data.result.jsConfig,r="/pages/goods/order_pay_status/index?order_id="+a+"&msg="+e.msg+"&type=3&totalPrice="+i.totalPrice;switch(s){case"ORDER_EXIST":case"EXTEND_ORDER":case"PAY_ERROR":return t.hideLoading(),n.$util.Tips({title:e.msg},{tab:5,url:r});case"SUCCESS":return t.hideLoading(),n.BargainId||n.combinationId||n.pinkId||n.seckillId||n.discountId?n.$util.Tips({title:e.msg,icon:"success"},{tab:4,url:r}):n.$util.Tips({title:e.msg,icon:"success"},{tab:5,url:r});case"WECHAT_PAY":n.toPay=!0,t.requestPayment({timeStamp:o.timestamp,nonceStr:o.nonceStr,package:o.package,signType:o.signType,paySign:o.paySign,success:function(e){return t.hideLoading(),n.BargainId||n.combinationId||n.pinkId||n.seckillId||n.discountId?n.$util.Tips({title:"支付成功",icon:"success"},{tab:4,url:r}):n.$util.Tips({title:"支付成功",icon:"success"},{tab:5,url:r})},fail:function(e){return t.hideLoading(),n.$util.Tips({title:"取消支付"},{tab:5,url:r+"&status=2"})},complete:function(i){if(t.hideLoading(),"requestPayment:cancel"==e.errMsg)return n.$util.Tips({title:"取消支付"},{tab:5,url:r+"&status=2"})}});break;case"PAY_DEFICIENCY":return t.hideLoading(),n.$util.Tips({title:e.msg},{tab:5,url:r+"&status=1"});case"WECHAT_H5_PAY":t.hideLoading(),n.$util.Tips({title:"订单创建成功!"},{tab:4,url:r+"&status=0"}),setTimeout((function(){location.href=e.data.result.jsConfig.mweb_url}),2e3);break;case"ALIPAY_PAY":t.navigateTo({url:"/pages/users/alipay_invoke/index?id=".concat(a,"&link=").concat(o.qrCode)});break}})).catch((function(e){return t.hideLoading(),n.$util.Tips({title:e})}))},clickTextArea:function(){this.$refs.textarea.focus()},bindDateChange:function(t,e){this.confirm[e].value=t.target.value},bindTimeChange:function(t,e){this.confirm[e].value=t.target.value},SubOrder:function(e){var i,n=this;if(!n.payType)return n.$util.Tips({title:"请选择支付方式"});if(!n.addressId&&!n.shippingType&&!n.product_type)return n.$util.Tips({title:"请选择收货地址"});if(1==n.shippingType){if(""==n.contacts||""==n.contactsTel)return n.$util.Tips({title:"请填写联系人或联系人电话"});if(!/^1(3|4|5|7|8|9|6)\d{9}$/.test(n.contactsTel))return n.$util.Tips({title:"请填写正确的手机号"});if(!/^[\u4e00-\u9fa5\w]{2,16}$/.test(n.contacts))return n.$util.Tips({title:"请填写您的真实姓名"});if(0==n.storeList.length)return n.$util.Tips({title:"暂无门店,请选择其他方式"})}for(var s=0;s<n.confirm.length;s++){var a=n.confirm[s];if(a.status||"img"!==a.label&&a.value&&a.value.trim()){if(("text"===a.label||"data"===a.label||"time"===a.label)&&(!a.value||a.value&&!a.value.trim()))return n.$util.Tips({title:"请填写".concat(a.title)});if("number"===a.label&&a.value<=0)return n.$util.Tips({title:"请填写大于0的".concat(a.title)});if("email"===a.label&&!/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/.test(a.value))return n.$util.Tips({title:"请填写正确的".concat(a.title)});if("phone"===a.label&&!/^1(3|4|5|7|8|9|6)\d{9}$/i.test(a.value))return n.$util.Tips({title:"请填写正确的".concat(a.title)});if("id"===a.label&&!/^[1-9]\d{7}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}$|^[1-9]\d{5}[1-9]\d{3}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}([0-9]|X)$/i.test(a.value))return n.$util.Tips({title:"请填写正确的".concat(a.title)});if("img"===a.label&&!a.value.length)return n.$util.Tips({title:"请上传".concat(a.title)})}}if(i={custom_form:n.confirm,real_name:n.contacts,phone:n.contactsTel,addressId:n.addressId,formId:"",couponId:0==n.priceGroup.couponPrice?0:n.couponId,payType:n.payType,useIntegral:n.useIntegral,bargainId:n.BargainId,combinationId:n.combinationId,discountId:n.discountId,pinkId:n.pinkId,seckill_id:n.seckillId,mark:n.mark,store_id:n.system_store?n.system_store.id:0,from:n.from,shipping_type:n.$util.$h.Add(n.shippingType,1),new:n.news,invoice_id:n.invChecked},"yue"==i.payType&&parseFloat(n.userInfo.now_money)<parseFloat(n.totalPrice))return n.$util.Tips({title:"余额不足！"});t.showLoading({title:"订单支付中"}),(0,o.openPaySubscribe)().then((function(){n.payment(i)}))}}};e.default=u}).call(this,i("543d")["default"])},"6bb1":function(t,e,i){"use strict";i.r(e);var n=i("54d8"),s=i("4a85");for(var a in s)["default"].indexOf(a)<0&&function(t){i.d(e,t,(function(){return s[t]}))}(a);i("2152");var o=i("f0c5"),r=Object(o["a"])(s["default"],n["b"],n["c"],!1,null,"1743d7f2",null,!1,n["a"],void 0);e["default"]=r.exports},addd:function(t,e,i){"use strict";(function(t,e){var n=i("4ea4");i("8824");n(i("66fd"));var s=n(i("6bb1"));t.__webpack_require_UNI_MP_PLUGIN__=i,e(s.default)}).call(this,i("bc2e")["default"],i("543d")["createPage"])}},[["addd","common/runtime","common/vendor"]]]);